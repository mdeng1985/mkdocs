
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Mdeng li">
      
      
        <link rel="canonical" href="https://mdeng1985.github.io/mkdocs/2-%E5%85%B7%E4%BD%93%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5/ROS/gazebo%20%E5%AE%98%E6%96%B9tutorials/Connect%20to%20ROS/3-Tutorial%20ROS%20Control/">
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.1">
    
    
      
        <title>Tutorial: ROS Control - Mdeng Li's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.9299cb39.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","None","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../../../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial-ros-control" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Mdeng Li&#39;s Blog" class="md-header__button md-logo" aria-label="Mdeng Li's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mdeng Li's Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial: ROS Control
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/squidfunk/mkdocs" title="前往 GitHub 仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mkdocs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Mdeng Li&#39;s Blog" class="md-nav__button md-logo" aria-label="Mdeng Li's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Mdeng Li's Blog
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/squidfunk/mkdocs" title="前往 GitHub 仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mkdocs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mkdocs_src/" class="md-nav__link">
        首页
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        兴趣
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="兴趣" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          兴趣
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mkdocs_src/getting-started/" class="md-nav__link">
        Installation
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        工作
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="工作" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          工作
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mkdocs_src/setup/changing-the-colors/" class="md-nav__link">
        Changing the colors
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        办公
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="办公" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          办公
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mkdocs_src/reference/abbreviations/" class="md-nav__link">
        Abbreviations
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mkdocs_src/mkdocs%E8%AF%AD%E6%B3%95/" class="md-nav__link">
        mkdocs
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Insiders
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Insiders" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Insiders
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mkdocs_src/insiders/" class="md-nav__link">
        Sponsorship
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ros_control" class="md-nav__link">
    ros_control 介绍
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ros_control-gazebo" class="md-nav__link">
    ros_control 和 Gazebo 中的数据流
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rrbot" class="md-nav__link">
    RRBot 实践
  </a>
  
    <nav class="md-nav" aria-label="RRBot 实践">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rrbotxacro" class="md-nav__link">
    在rrbot.xacro里添加传动部件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rrbotgazebogazebo_ros_control" class="md-nav__link">
    在rrbot.gazebo里添加gazebo_ros_control插件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#yaml" class="md-nav__link">
    创建 .yaml 配置文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#roslaunch" class="md-nav__link">
    创建 roslaunch 启动文件
  </a>
  
    <nav class="md-nav" aria-label="创建 roslaunch 启动文件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    解读
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#roslaunch_1" class="md-nav__link">
    启动roslaunch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    进阶阅读
  </a>
  
    <nav class="md-nav" aria-label="进阶阅读">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    手动发送命令
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    下一步
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="tutorial-ros-control">Tutorial: ROS Control<a class="headerlink" href="#tutorial-ros-control" title="Permanent link">&para;</a></h1>
<p>本教程利用<a href="http://ros.org/wiki/ros_control">ros_control</a> 工具包驱动机器人中的关节.</p>
<p>上一课程为: <a href="http://gazebosim.org/tutorials/?tut=ros_urdf">Using URDF in Gazebo</a> </p>
<p>首先需要确保安装了ros_control, 安装过程见<a href="http://gazebosim.org/tutorials?tut=ros_installing&amp;cat=connect_ros">installation instructions</a>.</p>
<p>Make sure you have already installed ros_control, ros_controllers, and their dependencies as described in the</p>
<h2 id="ros_control">ros_control 介绍<a class="headerlink" href="#ros_control" title="Permanent link">&para;</a></h2>
<p>We encourage you to read an overview of the documentation on <a href="http://ros.org/wiki/ros_control">ros_control</a> before proceeding.</p>
<h2 id="ros_control-gazebo">ros_control 和 Gazebo 中的数据流<a class="headerlink" href="#ros_control-gazebo" title="Permanent link">&para;</a></h2>
<p>Simulating a robot's controllers in Gazebo can be accomplished using ros_control and a simple Gazebo plugin adapter.</p>
<p>仿真 硬件 控制器以及传动(transmissions)的大致关系如下图所示:</p>
<p>![[Pasted image 20210403115415.png]]</p>
<p>关系如下: 来自<a href="https://www.guyuehome.com/890">ROS探索总结（三十一）——ros_control</a></p>
<ol>
<li>Controller Manager：每个机器人可能有多个controller，所以这里有一个控制器管理器的概念，提供一种通用的接口来管理不同的controller。controller manager的输入就是ROS上层应用的输出。</li>
<li>Controller：controller可以完成每个joint的控制，请求下层的硬件资源，并且提供了PID控制器，读取硬件资源接口中的状态，在发布控制命令。</li>
<li>Hardware Rescource：为上下两层提供硬件资源的接口。</li>
<li>RobotHW：硬件抽象层和硬件直接打交道，通过write和read方法来完成硬件的操作，这一层也包含关节限位、力矩转换、状态转换等功能。</li>
<li>Real Robot：实际的机器人上也需要有自己的嵌入式控制器，接收到命令后需要反映到执行器上，比如接收到位置1的命令后，那就需要让执行器快速、稳定的到达位置1。</li>
</ol>
<h2 id="rrbot">RRBot 实践<a class="headerlink" href="#rrbot" title="Permanent link">&para;</a></h2>
<p>^ae67a5</p>
<p>主要步骤如下:</p>
<ol>
<li>在URDF模型里添加传动部件(transmission elements)</li>
<li>在<code>.gazebo</code>里添加<code>gazebo_ros_control</code>插件</li>
</ol>
<h3 id="rrbotxacro">在<code>rrbot.xacro</code>里添加传动部件<a class="headerlink" href="#rrbotxacro" title="Permanent link">&para;</a></h3>
<p>如下:</p>
<div class="highlight"><pre><span></span><code>  <span class="nt">&lt;transmission</span> <span class="na">name=</span><span class="s">&quot;tran1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;type&gt;</span>transmission_interface/SimpleTransmission<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&quot;joint1&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;hardwareInterface&gt;</span>EffortJointInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
    <span class="nt">&lt;/joint&gt;</span>
    <span class="nt">&lt;actuator</span> <span class="na">name=</span><span class="s">&quot;motor1&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;hardwareInterface&gt;</span>EffortJointInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
      <span class="nt">&lt;mechanicalReduction&gt;</span>1<span class="nt">&lt;/mechanicalReduction&gt;</span>
    <span class="nt">&lt;/actuator&gt;</span>
  <span class="nt">&lt;/transmission&gt;</span>

  <span class="nt">&lt;transmission</span> <span class="na">name=</span><span class="s">&quot;tran2&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;type&gt;</span>transmission_interface/SimpleTransmission<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&quot;joint2&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;hardwareInterface&gt;</span>EffortJointInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
    <span class="nt">&lt;/joint&gt;</span>
    <span class="nt">&lt;actuator</span> <span class="na">name=</span><span class="s">&quot;motor2&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;hardwareInterface&gt;</span>EffortJointInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
      <span class="nt">&lt;mechanicalReduction&gt;</span>1<span class="nt">&lt;/mechanicalReduction&gt;</span>
    <span class="nt">&lt;/actuator&gt;</span>
  <span class="nt">&lt;/transmission&gt;</span>
</code></pre></div>
<p>其中:</p>
<ul>
<li><code>joint name="joint1"</code>表明该传动部件是joint1的传动部件, transmission的标签的作用是将驱动机构和joint联系起来.</li>
<li><code>&lt;hardwareInterface&gt;</code>定义在<code>&lt;actuator&gt;</code>和<code>&lt;joint&gt;</code>标签中的，它告诉gazebo_ros_control插件要加载哪些硬件接口（位置，速度或力度接口）。当前仅实现力度接口。</li>
</ul>
<h3 id="rrbotgazebogazebo_ros_control">在<code>rrbot.gazebo</code>里添加<code>gazebo_ros_control</code>插件<a class="headerlink" href="#rrbotgazebogazebo_ros_control" title="Permanent link">&para;</a></h3>
<p>如下,添加插件可以读取<code>xacro</code>文件中的 <code>&lt;transmission&gt;</code>标签里的内容</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;gazebo&gt;</span>
  <span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">&quot;gazebo_ros_control&quot;</span> <span class="na">filename=</span><span class="s">&quot;libgazebo_ros_control.so&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;robotNamespace&gt;</span>/rrbot<span class="nt">&lt;/robotNamespace&gt;</span>
  <span class="nt">&lt;/plugin&gt;</span>
<span class="nt">&lt;/gazebo&gt;</span>
</code></pre></div>
<p>In addition to the transmission tags, a Gazebo plugin needs to be added to your URDF that actually parses the transmission tags and loads the appropriate hardware interfaces and controller manager.
By default the gazebo_ros_control plugin is very simple, though it is also extensible via an additional plugin architecture to allow power users to create their own custom robot hardware interfaces between ros_control and Gazebo.</p>
<p>The default plugin XML should be added to your URDF:</p>
<div class="highlight"><pre><span></span><code>&lt;gazebo&gt;
  &lt;plugin name=&quot;gazebo_ros_control&quot; filename=&quot;libgazebo_ros_control.so&quot;&gt;
    &lt;robotNamespace&gt;/MYROBOT&lt;/robotNamespace&gt;
  &lt;/plugin&gt;
&lt;/gazebo&gt;
</code></pre></div>
<p>gazebo_ros_control <code>&lt;plugin&gt;</code>标签的相关选项</p>
<ul>
<li><code>&lt;robotNamespace&gt;</code>: The ROS namespace to be used for this instance of the plugin, defaults to robot name in URDF/SDF</li>
<li><code>&lt;controlPeriod&gt;</code>: The period of the controller update (in seconds), defaults to Gazebo's period</li>
<li><code>&lt;robotParam&gt;</code>: The location of the robot_description (URDF) on the parameter server, defaults to '/robot_description'</li>
<li><code>&lt;robotSimType&gt;</code>: The pluginlib name of a custom robot sim interface to be used (see below for more details), defaults to 'DefaultRobotHWSim'</li>
</ul>
<h3 id="yaml">创建 .yaml 配置文件<a class="headerlink" href="#yaml" title="Permanent link">&para;</a></h3>
<p>PID控制器的增益矩阵和控制器设置需要存储在yaml文件下, 用于被ros的参数服务器读取.</p>
<p>比如:<code>MYROBOT_control/config/rrbot_control.yaml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">rrbot</span><span class="p">:</span>
  <span class="c1"># Publish all joint states -----------------------------------</span>
  <span class="nt">joint_state_controller</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">joint_state_controller/JointStateController</span>
    <span class="nt">publish_rate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">50</span>  

  <span class="c1"># Position Controllers ---------------------------------------</span>
  <span class="nt">joint1_position_controller</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">effort_controllers/JointPositionController</span>
    <span class="nt">joint</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">joint1</span>
    <span class="nt">pid</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt">p</span><span class="p">:</span> <span class="nv">100.0</span><span class="p p-Indicator">,</span><span class="nt"> i</span><span class="p">:</span> <span class="nv">0.01</span><span class="p p-Indicator">,</span><span class="nt"> d</span><span class="p">:</span> <span class="nv">10.0</span><span class="p p-Indicator">}</span>
  <span class="nt">joint2_position_controller</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">effort_controllers/JointPositionController</span>
    <span class="nt">joint</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">joint2</span>
    <span class="nt">pid</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt">p</span><span class="p">:</span> <span class="nv">100.0</span><span class="p p-Indicator">,</span><span class="nt"> i</span><span class="p">:</span> <span class="nv">0.01</span><span class="p p-Indicator">,</span><span class="nt"> d</span><span class="p">:</span> <span class="nv">10.0</span><span class="p p-Indicator">}</span>
</code></pre></div>
<h3 id="roslaunch">创建 roslaunch 启动文件<a class="headerlink" href="#roslaunch" title="Permanent link">&para;</a></h3>
<p>如下所示:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;launch&gt;</span>

  <span class="c">&lt;!-- Load joint controller configurations from YAML file to parameter server --&gt;</span>
  <span class="nt">&lt;rosparam</span> <span class="na">file=</span><span class="s">&quot;$(find rrbot_control)/config/rrbot_control.yaml&quot;</span> <span class="na">command=</span><span class="s">&quot;load&quot;</span><span class="nt">/&gt;</span>

  <span class="c">&lt;!-- load the controllers --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;controller_spawner&quot;</span> <span class="na">pkg=</span><span class="s">&quot;controller_manager&quot;</span> <span class="na">type=</span><span class="s">&quot;spawner&quot;</span> <span class="na">respawn=</span><span class="s">&quot;false&quot;</span>
    <span class="na">output=</span><span class="s">&quot;screen&quot;</span> <span class="na">ns=</span><span class="s">&quot;/rrbot&quot;</span> <span class="na">args=</span><span class="s">&quot;joint1_position_controller joint2_position_controller joint_state_controller&quot;</span><span class="nt">/&gt;</span>

  <span class="c">&lt;!-- convert joint states to TF transforms for rviz, etc --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;robot_state_publisher&quot;</span> <span class="na">pkg=</span><span class="s">&quot;robot_state_publisher&quot;</span> <span class="na">type=</span><span class="s">&quot;robot_state_publisher&quot;</span>
    <span class="na">respawn=</span><span class="s">&quot;false&quot;</span> <span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;remap</span> <span class="na">from=</span><span class="s">&quot;/joint_states&quot;</span> <span class="na">to=</span><span class="s">&quot;/rrbot/joint_states&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/node&gt;</span>

<span class="nt">&lt;/launch&gt;</span>
</code></pre></div>
<h4 id="_1">解读<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><code>&lt;rosparam file="$(find rrbot_control)/config/rrbot_control.yaml" command="load"/&gt;</code> 导入配置文件</p>
</li>
<li>
<p>启动controller_manager包里的节点spawner</p>
</li>
</ul>
<p>作用是load三个控制器</p>
<ul>
<li>joint1_position_controller </li>
<li>joint2_position_controller</li>
<li>joint_state_controller</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c">&lt;!-- load the controllers --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;controller_spawner&quot;</span> <span class="na">pkg=</span><span class="s">&quot;controller_manager&quot;</span> <span class="na">type=</span><span class="s">&quot;spawner&quot;</span> <span class="na">respawn=</span><span class="s">&quot;false&quot;</span>
  <span class="na">output=</span><span class="s">&quot;screen&quot;</span> <span class="na">ns=</span><span class="s">&quot;/rrbot&quot;</span> <span class="na">args=</span><span class="s">&quot;joint1_position_controller joint2_position_controller joint_state_controller&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>
<ul>
<li>启动<code>robot_state _publisher</code>, 该节点仅侦听来自<code>joint_state_controller</code>的<code>joint_states</code>消息，然后将转换发布到tf。</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c">&lt;!-- convert joint states to TF transforms for rviz, etc --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;robot_state_publisher&quot;</span> <span class="na">pkg=</span><span class="s">&quot;robot_state_publisher&quot;</span> <span class="na">type=</span><span class="s">&quot;robot_state_publisher&quot;</span>
  <span class="na">respawn=</span><span class="s">&quot;false&quot;</span> <span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;remap</span> <span class="na">from=</span><span class="s">&quot;/joint_states&quot;</span> <span class="na">to=</span><span class="s">&quot;/rrbot/joint_states&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/node&gt;</span>
</code></pre></div>
<h3 id="roslaunch_1">启动roslaunch<a class="headerlink" href="#roslaunch_1" title="Permanent link">&para;</a></h3>
<p>首先启动仿真</p>
<div class="highlight"><pre><span></span><code>roslaunch rrbot_gazebo rrbot_world.launch
</code></pre></div>
<p>然后启动控制器</p>
<div class="highlight"><pre><span></span><code>roslaunch rrbot_control rrbot_control.launch
</code></pre></div>
<h3 id="_2">进阶阅读<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<h4 id="_3">手动发送命令<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<p>输入如下的命令, 会发现gazebo里的机械臂关节动了</p>
<div class="highlight"><pre><span></span><code>rostopic pub -1 /rrbot/joint1_position_controller/command std_msgs/Float64 <span class="s2">&quot;data: 1.5&quot;</span>
rostopic pub -1 /rrbot/joint2_position_controller/command std_msgs/Float64 <span class="s2">&quot;data: 1.0&quot;</span>
</code></pre></div>
<p>rostopic pub的用法: <code>pub &lt;topic-name&gt; &lt;topic-type&gt; [data...]</code></p>
<div class="highlight"><pre><span></span><code>rostopic pub /topic_name std_msgs/String hello
</code></pre></div>
<p><strong>没有想明白原理</strong></p>
<h2 id="_4">下一步<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>Learn about ROS message and service calls that are available for use with Gazebo in the tutorial <a href="http://gazebosim.org/tutorials/?tut=ros_comm">ROS Communication with Gazebo</a>.</p>
<h1 id="_5">以下没看<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h1>
<h3 id="advanced-custom-gazebo_ros_control-simulation-plugins">Advanced: custom gazebo_ros_control Simulation Plugins<a class="headerlink" href="#advanced-custom-gazebo_ros_control-simulation-plugins" title="Permanent link">&para;</a></h3>
<p>The gazebo_ros_control Gazebo plugin also provides a pluginlib-based interface to implement custom interfaces between Gazebo and ros_control for simulating more complex mechanisms (nonlinear springs, linkages, etc).</p>
<p>These plugins must inherit gazebo_ros_control::RobotHWSim which implements a simulated ros_control hardware_interface::RobotHW.
RobotHWSim provides API-level access to read and command joint properties in the Gazebo simulator.</p>
<p>The respective RobotHWSim sub-class is specified in a URDF model and is loaded when the robot model is loaded.
For example, the following XML will load the default plugin (same behavior as when using no <code>&lt;robotSimType&gt;</code> tag):</p>
<div class="highlight"><pre><span></span><code>&lt;gazebo&gt;
  &lt;plugin name=&quot;gazebo_ros_control&quot; filename=&quot;libgazebo_ros_control.so&quot;&gt;
    &lt;robotNamespace&gt;/MYROBOT&lt;/robotNamespace&gt;
    &lt;robotSimType&gt;gazebo_ros_control/DefaultRobotHWSim&lt;/robotSimType&gt;
  &lt;/plugin&gt;
&lt;/gazebo&gt;
</code></pre></div>
<h2 id="rrbot-example">RRBot Example<a class="headerlink" href="#rrbot-example" title="Permanent link">&para;</a></h2>
<h3 id="using-service-calls-manually">Using service calls manually<a class="headerlink" href="#using-service-calls-manually" title="Permanent link">&para;</a></h3>
<p>If you first load the rrbot_control.yaml files to the parameter server, you could load the controllers manually through service requests.
We'll include them here for reference though we usually prefer roslaunch:</p>
<p>Load the controllers:</p>
<div class="highlight"><pre><span></span><code>rosservice call /rrbot/controller_manager/load_controller &quot;name: &#39;joint1_position_controller&#39;&quot;
rosservice call /rrbot/controller_manager/load_controller &quot;name: &#39;joint2_position_controller&#39;&quot;
</code></pre></div>
<p>Start the controllers:</p>
<div class="highlight"><pre><span></span><code>rosservice call /rrbot/controller_manager/switch_controller &quot;{start_controllers: [&#39;joint1_position_controller&#39;,&#39;joint2_position_controller&#39;], stop_controllers: [], strictness: 2}&quot;
</code></pre></div>
<p>Stop the controllers:</p>
<div class="highlight"><pre><span></span><code>rosservice call /rrbot/controller_manager/switch_controller &quot;{start_controllers: [], stop_controllers: [&#39;joint1_position_controller&#39;,&#39;joint2_position_controller&#39;], strictness: 2}&quot;
</code></pre></div>
<h2 id="use-rqt-to-send-commands">Use RQT To Send Commands<a class="headerlink" href="#use-rqt-to-send-commands" title="Permanent link">&para;</a></h2>
<p>In this section we'll go over tools to help you visualize the performance of your controller and tune any gains/parameters the controller might have, particularly PID gains.
We'll be using <a href="http://www.ros.org/wiki/rqt">RQT</a>, ROS's plugin-based user interface, so be sure you first have that installed.</p>
<p>Start RQT:</p>
<div class="highlight"><pre><span></span><code>rosrun rqt_gui rqt_gui
</code></pre></div>
<h3 id="add-a-command-publisher">Add a Command Publisher<a class="headerlink" href="#add-a-command-publisher" title="Permanent link">&para;</a></h3>
<p>On the 'Plugins' menu of RQT add the 'Topics-&gt;Message Publisher' plugin then choose the topic from the drop down box that commands any particular controller that you want to publish to.
For the RRBot, add the controller:</p>
<div class="highlight"><pre><span></span><code>/rrbot/joint1_position_controller/command
</code></pre></div>
<p>Then press the green plus sign button at the top right.</p>
<p>Enable the topic publisher by checking the check box on the left of the topic name.
Set the rate column to 100 (the frequency we send it commands - 100hz in this case).</p>
<p>Next, expand the topic so that you see the "data" row.
In the expression column, on the data row, try different radian values between joint1's joint limits - in RRBot's case there are no limits because the joints are continuous, so any value works.
You should be able to get the RRBot to swing around if you are doing this tutorial with that robot.</p>
<p>Next, in that same expression box we'll have it automatically change values using a sine wave.
Add the following:</p>
<div class="highlight"><pre><span></span><code>sin(i/100)
</code></pre></div>
<p>For more advanced control, you can configure it to publish a sine wave to your robot's exact joint limits:</p>
<div class="highlight"><pre><span></span><code>sin(i/rate*speed)*diff + offset
</code></pre></div>
<p>An explanation of variables:</p>
<ul>
<li>i - the RQT variable for time</li>
<li>rate - the frequency that this expression is evaluated. This should be the same number as in the rate column of the topic publisher. Recommended value is 100.</li>
<li>speed - how quick you want the join to actuate. Start off with just 1 for a slow speed</li>
<li>upper_limit and lower_limits - the joint limits of the hardware being controlled by this controller</li>
<li>diff = (upper_limit - lower_limit)/2</li>
<li>offset = upper_limit-diff</li>
</ul>
<h3 id="visualize-the-controllers-performance">Visualize the controller's performance<a class="headerlink" href="#visualize-the-controllers-performance" title="Permanent link">&para;</a></h3>
<p>Add a Plot plugin to RQT and add the same topic as the one you chose above for the topic publisher:</p>
<div class="highlight"><pre><span></span><code>/rrbot/joint1_position_controller/command/data
</code></pre></div>
<p>Click the green add button.
You should now see a sine wave being plotted on the screen.</p>
<p>Add another topic to the Plot plugin that tracks the actual position of the actuator being controlled.  You will want to the reduce the error between these two values by tuning the PID gains, as shown in the next step.
For the RRBot:</p>
<div class="highlight"><pre><span></span><code>/rrbot/joint1_position_controller/state/process_value
</code></pre></div>
<p>Your screen should look something like this:</p>
<p>![[Pasted image 20210403115439.png]]</p>
<p>Note: the RQT plot plugin is known to have bugs after running for a while (&gt;1min).
The drawings start acting strangely.
The current solution is to press the blue refresh button at the top right of the plugin.</p>
<h3 id="tune-the-pid-gains">Tune the PID gains<a class="headerlink" href="#tune-the-pid-gains" title="Permanent link">&para;</a></h3>
<p>Finally, we'll use <a href="http://ros.org/wiki/dynamic_reconfigure">dynamic reconfigure</a> to tune the proportional, derivative, and integral gains of the PID controller, assuming this is applicable to your robot.</p>
<p>Add the 'Dynamic Reconfigure' plugin to RQT and click 'Expand All' to see the sub-options.
Assuming your controller uses PID, you should use a "pid" option.
Clicking on it should reveal 5 sliders that let you tune the controller, as pictured in the following screenshot.
Adjust these values until you get the desired performance of your controller.</p>
<p>![[Pasted image 20210403115459.png]]</p>
<h3 id="use-roslaunch-to-save-your-rqt-perspective">Use roslaunch to save your RQT perspective<a class="headerlink" href="#use-roslaunch-to-save-your-rqt-perspective" title="Permanent link">&para;</a></h3>
<p>A pre-configured RQT perspective for the rrbot can be easily launched with the following command:</p>
<div class="highlight"><pre><span></span><code>roslaunch rrbot_control rrbot_rqt.launch
</code></pre></div>
<p>You can use that as a template for doing this with your own robot.</p>
<h2 id="connect-rviz-to-gazebo-simulation">Connect Rviz to Gazebo Simulation<a class="headerlink" href="#connect-rviz-to-gazebo-simulation" title="Permanent link">&para;</a></h2>
<p>Now that you are using ros_control to send commands to your robot in simulation, you can also use the ros_control joint_state_controller to read the state of the robot from Gazebo.
The idea behind a good simulator is that you should be able to use the same software on your real hardware as you do in simulation.
A good starting point for that is visualizing your simulated robot in Rviz, similar to how it is done with real hardware.</p>
<p>Assuming you are already starting a joint_state_controller as documented above in your rosparam and roslaunch files, your next step is to start Rviz:</p>
<div class="highlight"><pre><span></span><code>rosrun rviz rviz
</code></pre></div>
<p>Under "Global Options" change your "Fixed Frame" to "world" to resolve any errors it might be giving you.</p>
<p>Next, add a "RobotModel" display type to Rviz and you should then see your simulated robot in Gazebo being visualized in Rviz!</p>
<h1 id="demo-code">Demo Code<a class="headerlink" href="#demo-code" title="Permanent link">&para;</a></h1>
<p>The example code used for the RRBot in this tutorial is available in the repository
<a href="https://github.com/ros-simulation/gazebo_ros_demos">gazebo_ros_demos</a>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; mdeng li
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../../..", "features": [], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../../../../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.7353b375.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>